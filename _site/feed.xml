<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Blog of TyrantaX</title>
        <description>Web Engineering Blog by TyrantaX</description>
        <link>http://www.freeclan.net/tyrantax</link>
        <atom:link href="http://www.freeclan.net/tyrantax/feed.xml" rel="self" type="application/rss+xml" />
        
            <item>
                <title>饮料与书籍</title>
                <description>&lt;p&gt;这年头的饮料里也多了不少泡沫——我说的并不是奶盖那种。&lt;/p&gt;

&lt;p&gt;几年前，珍珠奶茶统一六元一杯的时候，市场上还并没有那么多花样百出的饮料。大概也只有吃货和极富商业头脑的人，才能想象出奶盖上薄撒一层食盐的惊喜口感，或是意识到奥利奥是可以和可可、抹茶相颉颃的神奇粉末。&lt;/p&gt;

&lt;p&gt;现如今，二三十元的饮料已经是司空见惯——这也使得星巴克的装逼溢价缩减，性价比大幅提升。大街小巷的饮料店鳞次栉比，仅以上海福州路这条著名的书店之路计，饮料店的数量已远超书店的数量——但是，几乎每家店前都还排着长队，即使饮料的制作时间不过两三分钟。&lt;/p&gt;

&lt;p&gt;更多刺激味蕾的选择，在这个吃货时代里，多受几分厚爱似乎也无可厚非。&lt;/p&gt;

&lt;p&gt;毕竟，五味令人口爽。&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;五色令人目盲；五音令人耳聋；五味令人口爽；驰骋畋猎，令人心发狂；难得之货，令人行妨。&lt;/p&gt;

  &lt;p&gt;——《道德经》&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;与饮料业的繁荣昌盛之势相比，印刷业也不甘落后。从书名到装帧，从内容到主题，无一不是用另一种形式的新鲜感刺激着我们的味蕾……和钱包。&lt;/p&gt;

</description>
                <pubDate>Mon, 24 Oct 2016 00:00:00 +0000</pubDate>
                <link>http://www.freeclan.net/tyrantax/2016/10/24/tests/</link>
                <guid isPermaLink="true">http://www.freeclan.net/tyrantax/2016/10/24/tests/</guid>
            </item>
        
            <item>
                <title>饮料与书籍</title>
                <description>&lt;p&gt;这年头的饮料里也多了不少泡沫——我说的并不是奶盖那种。&lt;/p&gt;

&lt;p&gt;几年前，珍珠奶茶统一六元一杯的时候，市场上还并没有那么多花样百出的饮料。大概也只有吃货和极富商业头脑的人，才能想象出奶盖上薄撒一层食盐的惊喜口感，或是意识到奥利奥是可以和可可、抹茶相颉颃的神奇粉末。&lt;/p&gt;

&lt;p&gt;现如今，二三十元的饮料已经是司空见惯——这也使得星巴克的装逼溢价缩减，性价比大幅提升。大街小巷的饮料店鳞次栉比，仅以上海福州路这条著名的书店之路计，饮料店的数量已远超书店的数量——但是，几乎每家店前都还排着长队，即使饮料的制作时间不过两三分钟。&lt;/p&gt;

&lt;p&gt;更多刺激味蕾的选择，在这个吃货时代里，多受几分厚爱似乎也无可厚非。&lt;/p&gt;

&lt;p&gt;毕竟，五味令人口爽。&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;五色令人目盲；五音令人耳聋；五味令人口爽；驰骋畋猎，令人心发狂；难得之货，令人行妨。&lt;/p&gt;

  &lt;p&gt;——《道德经》&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;与饮料业的繁荣昌盛之势相比，印刷业也不甘落后。从书名到装帧，从内容到主题，无一不是用另一种形式的新鲜感刺激着我们的味蕾……和钱包。&lt;/p&gt;

&lt;p&gt;所幸让人欣慰的是，且不论读的书价值如何——毕竟如果从非功利的角度看的话，即使是读一些没什么营养的书，也并不比读高逼格书来得廉价，因为读书并不是为了“有用”的——这个时代的读书人也是前所未有得多，福州路自不必说，就是地铁里也常常能看到放下手机拿着书读的人。&lt;/p&gt;

&lt;p&gt;至于那些觉得“现在像你这样的读书人不多了”的人，坦白讲，或许是你自己读书少了。&lt;/p&gt;

&lt;p&gt;哎，对于夸我的人，我又说什么得罪人的大实话……😂&lt;/p&gt;

&lt;p&gt;有个叫“孕妇现象”的心理现象，说的是怀孕的人常常觉得周围好多人怀孕，一方面孕妇出入的场合会有更多的孕妇，另外一方面也是因为自己怀孕会更多注意到孕妇。而且，人们也常常用自己来揣度他人，所谓常识就是那些他自己知道的知识，所谓人情就是他自己认同的待人之道，所谓人性就是他自己不愿改变的缺点。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;当买一本书的花费，不过是一两杯饮料钱，人们到底会读更多还是更少的书？&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;这似乎是一个经济学和心理学问题。&lt;/p&gt;

&lt;p&gt;经济学告诉我们，商品存在一个“需求价格弹性模型”，当价格便宜的时候，需求就提升，因此在总收益曲线上，对销售商而言存在一个利益最大化的点。在这一模型中，价格是自变量，而需求是对价格的负相关应变量。这就意味着，只要书足够便宜，总会有更多的人来读——这似乎让我们觉得不太对劲。&lt;/p&gt;

&lt;p&gt;心理学告诉我们，付出得越多（“沉没成本”越大），在归因的时候，就越容易说服自己它的价值越高，甚至感觉自己越爱它。另一方面，免费的电子书可能是一种“过度激励”，它让我们接受了对书在金钱价值上的预期（“价格锚点”），以至于见到稍贵的书就觉得现在的出版社太黑了——即使它才花了你两杯饮料钱，却要耗费作者编辑等人一年多的辛苦付出。用这种理论，我们似乎应该对书籍的降价持悲观态度——不过估计下次亚马逊打折的时候，我还是不愿错过。&lt;/p&gt;

&lt;p&gt;至于古人买书爱书如何，不说远的，即使是民国时期，也常常可以听到省吃俭用，花了几个月工资买一本（而不是一套）书的故事。可以想见，这样买来的书也必然会像“书非借不能读”一样珍惜对待。而现在，就拿我来说，即使买书每年都要花好多钱，但是认真算的话，两三天的工资就够买一年的书了（咦，我是来炫耀工资的吗？不不，我买不起书了，老板快给我涨工资！😋）&lt;/p&gt;

&lt;p&gt;可能有人会比较在意，买来的这些书，到底读了多少比例的问题，不过我并不在意。以前也说过，高中时候买了很多教辅书，做完的可能不过三分之一，但是相比只买了一两本的人来说，我做的题肯定多得多。你要知道人是很贱的，你给了他选择的权利，他就会感恩戴德地认真纠结到底是早上吃三颗栗子、晚上吃四颗栗子，还是早上吃四颗栗子、晚上吃三颗栗子好。所以，买很多书的目的，并不在于强迫自己都读完，而是在你不想读这本书的时候，说不定想读另一本。&lt;/p&gt;

&lt;p&gt;那么，读书这件事究竟将何去何从？下面说说我的看法。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;首先，我觉得广义上的书籍会越来越便宜，理由主要是互联网时代带来的边际成本大幅降低。&lt;/strong&gt;这里的书籍，包括电子书的形式，包括暂时我们还无法理解的形式。非常贵的书肯定还是会有，只是并不作为大众主流消费的对象，因此也不在这个讨论范围内。只是说，作为一个普通读者，获得书的成本（甚至说获得知识的成本）是越来越低的，并且不要忘了计算通货膨胀。有人或许会反驳说，如果出版社联合起来抬高价格，或者不开放电子书呢？我想这个假设应该不成立，首先，垄断是违法的，其次，在“我不赚钱我傻啊”的博弈问题面前，君子都饿死了。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;我觉得讨论纸质书会不会灭亡的意义不大&lt;/strong&gt;，虽然肯定会，但是这件事的冲击力就像从竹简到绢帛到纸张一样，并不是我们没有经历过的。就我自己而言，现在读纸质书和电子书的时间比例是 2:1（我真是用软件记录的），而且读纸质书时往往更愿意读下去，但我对电子书的未来比较乐观。电子书的阅读体验还有很大的优化空间，而且我们对习惯的依赖也并没有自己想象得那么大。&lt;/p&gt;

&lt;p&gt;好消息是，&lt;strong&gt;读书的人也会变多&lt;/strong&gt;。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;坏消息（虽然也没有很坏吧）是，书籍将不可避免地被娱乐精神大幅冲刷&lt;/strong&gt;。——这也是为什么读书的人会变多的原因。&lt;/p&gt;

&lt;p&gt;从最早的时候，书只是连句读都没有的文字，到现在非常精美的插画、装帧和各种设计，娱乐因素对书籍的渗透力远超我们想象。&lt;/p&gt;

&lt;p&gt;从古代书籍处于统治阶级和士人阶级的垄断地位，到现在几乎所有人都可以花很少的一部分可支配收入买到足够阅读的书籍，无论书籍的金钱价值还是书籍的作用都发生了很大的变化。&lt;/p&gt;

&lt;p&gt;如果用心观察书店门口或是书籍电商的畅销榜，不难发现流行的书和经典的书之间的差距。我认为不该太过悲观地认为这是娱乐精神的腐蚀和时代的倒退，而只是一旦某个事物成为一种大众审美，就很难保持阳春白雪。&lt;/p&gt;

&lt;p&gt;——毕竟，这不够接地气。&lt;/p&gt;

&lt;p&gt;我觉得用庄子《齐物论》的角度非常适合看待这件事。&lt;/p&gt;

&lt;p&gt;读书，也不过就和看电视、玩游戏一样的一件小事。宇宙间的一切事物归根到底都没什么区别，没有高尚低俗之分，没有勤奋懒惰之分，没有才情庸俗之分，甚至没有生存与死亡之分。&lt;/p&gt;

&lt;p&gt;什么？听不懂？那我说得通俗点，就是——&lt;/p&gt;

&lt;p&gt;读书这件事，已经不适合装逼了。&lt;/p&gt;
</description>
                <pubDate>Tue, 04 Oct 2016 00:00:00 +0000</pubDate>
                <link>http://www.freeclan.net/tyrantax/2016/10/04/drinks-and-books/</link>
                <guid isPermaLink="true">http://www.freeclan.net/tyrantax/2016/10/04/drinks-and-books/</guid>
            </item>
        
            <item>
                <title>Using ECharts with TypeScript</title>
                <description>&lt;blockquote&gt;
  &lt;p&gt;This post introduces how to set up TypeScript environment with ECharts.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;First, we need to install &lt;a href=&quot;https://github.com/typings/typings&quot;&gt;typings&lt;/a&gt;, which is a definition manager for TypeScript.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;npm install typings --global
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;And then, install ECharts with &lt;code class=&quot;highlighter-rouge&quot;&gt;typings&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;typings install &lt;span class=&quot;nv&quot;&gt;echarts&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;github:DefinitelyTyped/DefinitelyTyped/echarts/echarts.d.ts#3305eb6f74a2de17d208dfaaa20d69cfb912f871 --save --global
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;In this stage, ECharts interface has been defined. Finally, we need to install ECharts with &lt;code class=&quot;highlighter-rouge&quot;&gt;npm&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;npm install echarts
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Now, &lt;code class=&quot;highlighter-rouge&quot;&gt;echarts&lt;/code&gt; can be accessed in your TypeScript file.&lt;/p&gt;

&lt;div class=&quot;language-ts highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Component&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'@angular/core'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;echarts&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'echarts'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;


&lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Component&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;templateUrl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'build/pages/page1/page1.html'&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Page3&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kd&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;echarts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// works here&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h1 id=&quot;explanation&quot;&gt;Explanation&lt;/h1&gt;

&lt;p&gt;ECharts TypeScript definition (non-official) can be found at &lt;a href=&quot;https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/echarts/echarts.d.ts&quot;&gt;DefinitelyTyped/echarts&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;3305eb6f74a2de17d208dfaaa20d69cfb912f871&lt;/code&gt; is the commit hash code, which can be replaced by the lasted one. This hash code is optional. Without it, &lt;code class=&quot;highlighter-rouge&quot;&gt;typings&lt;/code&gt; will give the error message as:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;typings WARN badlocation “github:DefinitelyTyped/DefinitelyTyped/echarts/echarts.d.ts” is mutable and may change, consider specifying a commit hash&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;--save&lt;/code&gt; changes settings in &lt;code class=&quot;highlighter-rouge&quot;&gt;typings.json&lt;/code&gt;, in pretty much the similar way as &lt;code class=&quot;highlighter-rouge&quot;&gt;npm install ... --save&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;--global&lt;/code&gt; tells TypeScript that the package to install, in our case, ECharts, should be accessed with &lt;code class=&quot;highlighter-rouge&quot;&gt;window.xxx&lt;/code&gt;. So, if you install a global package without this tag, you will probably get:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;typings ERR! message Attempted to compile “echarts” as an external module, but it looks like a global module. You’ll need to enable the global option to continue.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;After installation, we can use &lt;code class=&quot;highlighter-rouge&quot;&gt;git status&lt;/code&gt; to see what’s installed.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;git status
Changes not staged &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;commit:
  &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;use &lt;span class=&quot;s2&quot;&gt;&quot;git add &amp;lt;file&amp;gt;...&quot;&lt;/span&gt; to update what will be committed&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;use &lt;span class=&quot;s2&quot;&gt;&quot;git checkout -- &amp;lt;file&amp;gt;...&quot;&lt;/span&gt; to discard changes &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;working directory&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

    modified:   typings.json
    modified:   typings/index.d.ts

Untracked files:
  &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;use &lt;span class=&quot;s2&quot;&gt;&quot;git add &amp;lt;file&amp;gt;...&quot;&lt;/span&gt; to include &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;what will be committed&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

    typings/globals/echarts/

no changes added to commit &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;use &lt;span class=&quot;s2&quot;&gt;&quot;git add&quot;&lt;/span&gt; and/or &lt;span class=&quot;s2&quot;&gt;&quot;git commit -a&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;


&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;git diff
diff --git a/betterfly/typings.json b/betterfly/typings.json
index c44aff9..73add38 100644
--- a/betterfly/typings.json
+++ b/betterfly/typings.json
@@ -2,6 +2,7 @@
   &lt;span class=&quot;s2&quot;&gt;&quot;dependencies&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt;,
   &lt;span class=&quot;s2&quot;&gt;&quot;devDependencies&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt;,
   &lt;span class=&quot;s2&quot;&gt;&quot;globalDependencies&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
+    &lt;span class=&quot;s2&quot;&gt;&quot;echarts&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;github:DefinitelyTyped/DefinitelyTyped/echarts/echarts.d.ts#3305eb6f74a2de17d208dfaaa20d69cfb912f871&quot;&lt;/span&gt;,
     &lt;span class=&quot;s2&quot;&gt;&quot;es6-shim&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;registry:dt/es6-shim#0.31.2+20160602141504&quot;&lt;/span&gt;
   &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
 &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
diff --git a/betterfly/typings/index.d.ts b/betterfly/typings/index.d.ts
index 841268a..991e3f1 100644
--- a/betterfly/typings/index.d.ts
+++ b/betterfly/typings/index.d.ts
@@ -1 +1,2 @@
+/// &amp;lt;reference &lt;span class=&quot;nv&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;globals/echarts/index.d.ts&quot;&lt;/span&gt; /&amp;gt;
 /// &amp;lt;reference &lt;span class=&quot;nv&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;globals/es6-shim/index.d.ts&quot;&lt;/span&gt; /&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;In brief, this tells TypeScript the interface of ECharts when compiling TypeScript into JavaScript.&lt;/p&gt;

&lt;p&gt;Enjoy ECharts now!&lt;/p&gt;
</description>
                <pubDate>Wed, 24 Aug 2016 00:00:00 +0000</pubDate>
                <link>http://www.freeclan.net/tyrantax/2016/08/24/using-echarts-with-typescript/</link>
                <guid isPermaLink="true">http://www.freeclan.net/tyrantax/2016/08/24/using-echarts-with-typescript/</guid>
            </item>
        
            <item>
                <title>《永恒的终结》读后感 改变历史的正义性与效用性讨论</title>
                <description>&lt;p&gt;（本文有严重剧透）&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://book.douban.com/subject/25829693/&quot; target=&quot;_blank&quot;&gt;&lt;img class=&quot;book-img&quot; src=&quot;http://www.freeclan.net/tyrantax/img/loading.gif&quot; data-src=&quot;https://img3.doubanio.com/lpic/s27409671.jpg&quot; /&gt;&lt;/a&gt;上一次写&lt;a href=&quot;http://www.freeclan.net/tyrantax/all/?tag=书评&quot;&gt;读后感&lt;/a&gt;，已经将近一年以前了。这并不是一件好事，因为这意味着读完书以后，都没停下来好好回想并思考——虽然我可能辩解说，很多书可能并不值得我这么做。&lt;/p&gt;

&lt;p&gt;《永恒的终结》是我还在读研的时候，在学校的曦潮书店买的。当时觉得封面特别有吸引力，就买回去了。结果不幸束之高阁许久，因为读了个开头觉得有点乏味。这一点并不奇怪，因为我对大部分国外的小说都会有类似的感觉。&lt;/p&gt;

&lt;p&gt;直到前阵子看了另一部科幻小说《宇宙过河卒》，燃起了我对科幻的兴趣，才又将这本书重新拾起。&lt;/p&gt;

&lt;p&gt;本文对于《永恒的终结》中提到的永恒时空改变历史的正义性和效用性展开讨论。由于这是我读的为数不多的科幻小说，也是第一本阿西莫夫的小说，所以我的解读很有可能也并不正确，仅供作为发散思维的参考。&lt;/p&gt;

&lt;h1 id=&quot;section&quot;&gt;故事梗概&lt;/h1&gt;

&lt;p&gt;《永恒的终结》讲的是这样的一个故事。&lt;/p&gt;

&lt;p&gt;公元 24 世纪有一个叫马兰松的人发明了&lt;em&gt;时间力场&lt;/em&gt;，从而为 27 世纪&lt;em&gt;永恒时空&lt;/em&gt;的建造提供了理论依据。相对于永恒时空，我们现在直觉感受到的时空被称为&lt;em&gt;一般时空&lt;/em&gt;——我们通常认为一件事发生了就是发生了，历史只有一个。而在永恒之人（在永恒时空工作的人）可以改变一般时空的历史，从而对人类过于愚蠢的行为进行干预。当然，改变一个很小的事件，可能同时也会引发其他很多事件的改变，甚至产生很严重的后果——所谓的&lt;em&gt;蝴蝶效应&lt;/em&gt;，虽然作者并没有提到这个词。&lt;/p&gt;

&lt;p&gt;本文男主的职业是时空观测师，通过观察特定世纪下的种种现实，提供详细的报告，以供计算师更精确地计算出某种&lt;em&gt;最小需要变革&lt;/em&gt;可能引起的&lt;em&gt;最大可能反应&lt;/em&gt;。然而作者的设定是，永恒之人并不是能够永生没有衰老的人，而只是生活在永恒时空——这一不会受到变革影响的时空。一切都按步就序地进行着，直到有一天男主在一般时空中遇到了女主，并且发现即将产生的变革会导致女主在新的时空中不复存在。于是，男主决定冒天下之大不韪，违法将女主隐藏在 11 万世纪——位于一段隐藏时空，永恒之人也无法对其干预，闯进其中的结果是不可知的。&lt;/p&gt;

&lt;p&gt;（严重剧透预警！！！）&lt;/p&gt;

&lt;p&gt;这时候，男主又发现了一个惊人的秘密，原来此前让他负责教授一般时空人文历史的对象，居然是马兰松本人。他被派去 24 世纪之后，提出时空力场理论，晚年写了一本回忆录，记录下这个经历，其中就包括男主教他的这件事。这才有了男主被指派去教他的任务，为了完成闭环，为了永恒时空的存在。&lt;/p&gt;

&lt;p&gt;所以，男主意识到，他可以以打破闭环作为要挟，以挽救女主。但他不相信权威，导致认为被骗了，报复性地将马兰松送到了 20 世纪（该书写于 1955 年）。然后发现其实没人骗他，他本可以真的跟女主在一起，但现在永恒空间都要不存在了。于是，他带着女主前往 20 世纪寻找马兰松，准备将他送回 24 世纪。&lt;/p&gt;

&lt;p&gt;就在到了 20 世纪后，男主跟女主摊牌，说识破了女主是来自 11 万世纪的身份，目的是破坏永恒空间的存在。对此，女主供认不讳。两人就此展开了对永恒空间存在意义的一段讨论，也是全书的核心讨论之处。&lt;/p&gt;

&lt;p&gt;男主的论点是，永恒时空通过对历史的修改，保证了人类不至于因为愚蠢而自取灭亡的可能。&lt;/p&gt;

&lt;p&gt;女主的论点是——&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;永恒之人觉得什么是幸福？好吧，我告诉你答案——安全和安逸，中庸之道，永远不激进。如果没有百分之百确定的优厚回报，绝对不要冒险。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;由于人类在星系旅行这类高投入低回报的事上一再“浪费精力”，永恒时空干预了人类扩展领土的可能，以至于在人类抵达外星球的时候，银河系的其他星球早已被别的文明所占领，最终导致人类的毁灭。&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;在消弭人类灾难痛苦的同时，永恒时空也消除了人类走向辉煌的可能。只有经过严酷的考验人类才能不断前进；走向发展的高峰。危险的环境和危机感，才是驱使人类不断进步，不断征服新事物的根本动力。你能理解吗？你能否理解在消除人类生活中时时伴随的陷阱和苦痛的同时，永恒时空剥夺了人类自我发展、自我寻求克服困难的答案的权利？要知道，要想取得进步、持续发展，要紧的不是避免困难的出现，而是战胜困难，你明白吗？&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;当然，结局作者早已在书名中告诉我们——永恒的终结。于是，男主和女主留在了 20 世纪生活，而不再去管那个马兰松。于是，24 世纪将不再有人提出时空力场的概念，27 世纪也不会有人发明永恒时空。当然，以后还是会有人提出类似的概念，发明类似的永恒时空，但也会有类似女主的存在抵抗这股力量。&lt;/p&gt;

&lt;h1 id=&quot;section-1&quot;&gt;永恒时空干预的正义性&lt;/h1&gt;

&lt;p&gt;不得不说，这是一个精彩的故事。相比于《宇宙过河卒》中详细得几近冗长的相对论细节，《永恒的终极》显然是更“软”的科幻——但这丝毫不会减少它的魅力。它探讨了人类对自身发展的更多可控性是否真的有利于人类福祉。而在该书中，作者也给出了一个不那么开放性的回答。&lt;/p&gt;

&lt;p&gt;这一永恒时空的缺陷在于，它能够观察和改变的历史有时间的上下限制，比如观察不到 10 万年以后的隐藏空间。这一空间是更未来的人，为了避免永恒时空的干预影响自身存在，而设置的障碍。那么试想一下，如果永恒时空的观察范围是无限的，对于变革引起结果的预测几乎也完全准确，并且不必出于计算时间上的考虑而对一些可能性进行剪枝等等——简而言之，如果计算出人类发展的所有可能性（虽然这几乎可以认为是无穷的，但这里我们假设是有限并且可计算的），&lt;strong&gt;永恒时空为了让人类走向那个最好的未来的干预是否是&lt;span class=&quot;dot&quot;&gt;正义&lt;/span&gt;的？&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;显然，首先我们得讨论什么是对人类“好”的，什么是“正义”。&lt;/p&gt;

&lt;p&gt;以书中永恒之人的观点，“好”意味着&lt;span class=&quot;dot&quot;&gt;最多数人的福祉&lt;/span&gt;。这听起来非常功利主义，即追求整体利益的最大化。那么，让我们来回顾一下著名的&lt;em&gt;电车难题&lt;/em&gt;。&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;版本一：假设你驾驶一辆自己无法使其停下来的有轨电车，即将撞上前方轨道上的5个检修工人，他们根本来不及逃跑，除非你改变轨道。但是，备用轨道上却有1个人，那么，是否可以通过牺牲这一个人的生命而拯救另外五个人？&lt;/p&gt;

  &lt;p&gt;版本二：你站在天桥上，看到有一台刹车损坏的电车。在轨道前方，有五个正在工作的人，他们不晓得电车向他们冲来。一个体重很重的路人，正站在你身边，你发现他的巨大体形与重量，正好可以挡住电车，让电车出轨，不致于撞上那五个工人。你是否应该动手，把这个很胖的路人从天桥上推落，以拯救那五个工人，还是应该坐视电车撞上那五个工人？&lt;/p&gt;

  &lt;ul&gt;
    &lt;li&gt;&lt;em&gt;功利主义&lt;/em&gt;认为，&lt;strong&gt;为追求对最大多数人来说的最大效益，应该牺牲少数人来拯救多数人&lt;/strong&gt;。因此，在上述两个版本的思想实验中，都应该要牺牲一个人，来拯救五个人。&lt;/li&gt;
    &lt;li&gt;&lt;em&gt;康德主义&lt;/em&gt;认为，&lt;strong&gt;道德应该建立在必要的义务责任上&lt;/strong&gt;。如果不可以杀人是一种道德义务，在上述两个版本的思想实验中，都不应该动手，让一个人牺牲，即使这个行为的后果是牺牲五个人。&lt;/li&gt;
  &lt;/ul&gt;

  &lt;p&gt;心理学家发现，大多数人在面对第一个状况：可以切换轨道，让电车撞上一个人，或是不切换，让电车撞上五个人时，都会选择切换轨道。但是在面对第二个状况：亲手把路人丢下天桥，让电车出轨，以拯救五个人，或是不动手，让电车撞上五个人时，大多数人又会选择不动手。显示人类拥有的道德直觉，在第一个状况中，像是功利主义一样运作，而在第二个状况中，则像是道德义务论者。&lt;/p&gt;

  &lt;p&gt;摘自&lt;a href=&quot;https://zh.wikipedia.org/wiki/%E6%9C%89%E8%BD%A8%E7%94%B5%E8%BD%A6%E9%9A%BE%E9%A2%98&quot;&gt;有轨电车难题维基百科&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;虽然我并不太认同康德的观点，但我的结论和他是一致的，就是在这两种情况下，我都不应该牺牲一个人去拯救五个人。而我的理由是，我作为一个普通的个人，没有对任何人生杀夺予的权利，即使拯救五个人，也并不会赋予我这种权利。&lt;/p&gt;

&lt;p&gt;当然，道德或者正义都是受到时代和社会影响很深的，在我看来，相比绝对真理，它们更像是一种社会共识。虽然坦白讲，我承认这种共识的产生原因可能是功利性的——原始人愿意牺牲杀人的自由，换取自己不被杀害，从而“约定”了这样的共识，从此杀人成为不道德的。但我相信（或者说宁愿相信），即是这种共识的产生目的是功利性的，在思考一件事是否道德的时候，是不应该出于功利心或是把功利性的本质作为功利地思考的借口的。这就好比说，即使我们认同人有传递基因的本性，将其作为强奸的理由并不会减少这件事的不道德性。&lt;/p&gt;

&lt;p&gt;如果你仍认为为救五个人，牺牲一个人是应该的，那么你至少可以想想，如果你可能是那五个人之一，也可能是备用轨道上的那一个人，当你不知道你可能是谁的情况下，你希望切换轨道的人如何行动呢？当然，你的回答不能基于知道你会在哪条轨道上，并且，这不是一个概率问题，不要辩解说前者的概率是后者的五倍，没有人跟你保证关于概率的任何信息。&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;无知之幕（veil of ignorance）和原初状态是约翰·夏仙义提出的概念，之后约翰·罗尔斯在《正义论》中使用。是一种对特定道德问题判断的方法，过程是做以下思想实验：设想在“原初状态”下的一方，他们对自己所拥有的技能、品味、和地位于当社会的情况一概不知。而于此状况下让他们对权力、地位、和社会资源通过一定的原则分配予诸人。比如说，一个假定的奴隶制社会当中有50%的奴隶，于是做“无知之幕”思想实验的人们将会基于“进入这个社会的50%的人将会是奴隶”来做出选择，而不会只去认为自己是自由民。正如罗尔斯写道“…这一点保证了任何人都不会在选择原则时由于天然机会的结果或社会环境中的偶然事件而有利或不利。”这个概念是为了在分配社会合作的原则正义与否时抹除一己之私，或是自我阶层的私利而创造的。&lt;/p&gt;

  &lt;p&gt;摘自&lt;a href=&quot;https://zh.wikipedia.org/wiki/%E6%97%A0%E7%9F%A5%E4%B9%8B%E5%B9%95&quot;&gt;无知之幕维基百科&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;我的回答是，我希望切换轨道的人不要动。这样，如果我是那五个人之一，我会甘认倒霉，不会责备切换轨道的人。相反，如果他切换了轨道，而我是在备用轨道的人，我会迁怒于他（虽然对此我几乎无能为力），并认为他没有权利这么做。&lt;/p&gt;

&lt;p&gt;当然，你仍然可以不认同，否则这些问题就不会被称为&lt;em&gt;道德困境&lt;/em&gt;。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;回到永恒时空的问题，来自未来的永恒之人到底有没有权利决定我们的生死？基于上述结论，我的个人观点是，没有，他们没有这样的权利，即使只是改变明天会不会下雨这样的小事。&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;不过，作者并没有在这本书中明确讨论&lt;strong&gt;改变未来的&lt;span class=&quot;dot&quot;&gt;正义性&lt;/span&gt;&lt;/strong&gt;问题，而着重在&lt;strong&gt;改变未来的&lt;span class=&quot;dot&quot;&gt;效用性&lt;/span&gt;&lt;/strong&gt;。&lt;/p&gt;

&lt;h1 id=&quot;section-2&quot;&gt;永恒时空干预的效用性&lt;/h1&gt;

&lt;p&gt;所谓效用性，就还是功利主义的那一套，把人类作为一个整体，能不能在永恒时空的干预下，取得更大的成就。当然，这里的成就不仅仅是指人类存在的时长，其中也包括了幸福感、健康、星际旅行能力等等一个长得几乎没有尽头的列表。如何为这些指数赋值并且给定恰当的权重，虽然不是功利主义备受攻击的最大矛头所在，但也够功利主义者们头疼了。&lt;/p&gt;

&lt;p&gt;这里，我们暂且饶过他们，仅仅探讨以功利主义的逻辑来看，永恒时空的干预是否是有效的——即，对上述&lt;em&gt;成就&lt;/em&gt;起到了正向的推动作用。&lt;/p&gt;

&lt;p&gt;作者的观点非常明确——没有。理由也说得很明白，上文也有摘录。再回顾一下，简而言之，就是永恒时空虽然保障了一段时间内人类的平稳发展，但是为了规避风险，总是倾向于得出保守的发展方向，最终导致人类在星际旅行方面落后其他文明而自取灭亡。&lt;/p&gt;

&lt;p&gt;而我上面提出的假设，即如果永恒时空干预能够迅速得到所有改变可能性的最佳选择，而不会有所疏漏或不可知，永恒时空的干预在功利主义眼中是最好的选择吗？&lt;/p&gt;

&lt;p&gt;答案是当然是的，因为这不就是功利主义的定义么？&lt;/p&gt;

&lt;p&gt;所以，我觉得作者从“永恒时空的干预使人类星际旅行能力低下，从而导致人类灭亡”推到出“永恒时空的干预是恶性的”的结论是站不住脚的。作者并没有明确提出反对功利主义的态度，甚至从他暗示人类福祉的定义即征服星辰大海，似乎可以认为，这只是对上文我提到的&lt;em&gt;成就&lt;/em&gt;的定义与永和时空存在分歧。从功利主义者的角度看，他真正应该得出的结论是“永恒时空的干预之所以是恶性的，是因为掌握的信息不够，因而无法保障干预起到良性的效果”。&lt;/p&gt;

&lt;p&gt;用程序员的语言来说，这是一个 NP 问题，为了计算效率不得不利用贪婪算法剪枝，所以得到的结果只能是近似解，而很难正好是全局最优，并且常常陷入局部最优解。&lt;/p&gt;

&lt;p&gt;所以，如果作者真是一个功利主义者，那么他或许会认为，永恒时空在尚未获得完整信息的情况下，在非必要时刻不要进行干预——比如某国投了一枚足以毁灭地球的氢弹，那么干预的结果怎样都不会坏于人类整体灭绝，所以应该干预（参见博弈论 &lt;a href=&quot;https://en.wikipedia.org/wiki/Best_response&quot;&gt;best response&lt;/a&gt; 的概念）——直到掌握完整的信息，确保能够得到接近全局最优解的情况时，再进行干预。虽然我非常怀疑，掌握最够多的信息这件事本身是不是可行的，毕竟，这是一个混沌得不能再混沌的系统。&lt;/p&gt;

&lt;p&gt;当然，作者可能也并没有那么功利主义，从结局作者对任凭人类自由发展的信心，以及对爱情非理性因素的肯定，还是可以找出人文关怀的味道，不像纯粹的功利主义。因而，我不得不怀疑，将人类的福祉视作征服星辰大海有点白璧微瑕之嫌。&lt;/p&gt;

&lt;p&gt;如果说人类存在、发展、壮大、销亡，甚至有类似的文明又一次次相似而又不相似地循环，才是一种真正的永恒时空，不知道这样的世界观会不会更饱满一些？&lt;/p&gt;

</description>
                <pubDate>Sun, 21 Aug 2016 00:00:00 +0000</pubDate>
                <link>http://www.freeclan.net/tyrantax/2016/08/21/reviewing-the-end-of-eternity/</link>
                <guid isPermaLink="true">http://www.freeclan.net/tyrantax/2016/08/21/reviewing-the-end-of-eternity/</guid>
            </item>
        
            <item>
                <title>遍身罗绮者，不是养蚕人</title>
                <description>&lt;p&gt;上次写养蚕的事，是初三的应试作文。而当时老师的评价则是——你到底是不是真的养过蚕啊？&lt;/p&gt;

&lt;p&gt;为了锻炼自己的写作能力，我希望可以经常找点话题写写。今天要谈的，就是小学时候养蚕的故事。可惜应该找不到那时的作文了，不然真想拿出来好好比比。&lt;/p&gt;

&lt;p&gt;大约是小学四年级的时候，班上不知道哪个顽皮的同学带了二三十条蚕宝宝，分给班上的同学。当时我是转学生，没有很玩得来的朋友，但也分到了两三条。印象非常深刻的是，放在了小糖果盒里，然后偷偷塞在书桌中。&lt;/p&gt;

&lt;p&gt;我倒不记得最终班主任是怎么发现的，但毕竟十来个人分赃的大事，小学生能有多大能耐严严实实地藏住呢？
班主任当然没收了我们每个人的赃物，不过值得庆幸的是，她让我们放学后去她办公室拿。&lt;/p&gt;

&lt;p&gt;可以想见，这一天的课程必定特别漫长，而这一天的下课铃也必定特别清脆。
我不知道为什么，我居然是那个最后去老师办公室领蚕宝宝的人。但我知道的是，那天带着剩下没人领的十来条蚕宝宝回家的我，一定是笑得嘴都何不拢的。&lt;/p&gt;

&lt;p&gt;可能因为爸妈都不怎么喜欢小动物的关系，我一直也对宠物没什么特别的感觉。加之特别爱干净，以及莫名其妙的过敏，总是对猫狗类有毛的小动物心怀芥蒂。在此之前，我可能只养过几周的小鸡小鸭，然后就养死了……&lt;/p&gt;

&lt;p&gt;我也不知道为什么就很喜欢蚕宝宝，现在想想，可能很大程度上只是因为突然从两三条变成十来条，像捡到宝贝一样。要知道，那时它们可能才出生一两周的样子，又短又黑，大概只有一厘米长，半毫米宽——确实很难把它们和“宝宝”联系起来。&lt;/p&gt;

&lt;p&gt;这天，我带着十几条蚕宝宝回家，还有点担心会不会被爸妈数落不务正业——因为和很多人一样，直到高考结束前，父母眼中，我们的唯一正业就是读书（当然，还必须是教科书）。结果好像并没有挨骂，可能因为我爸妈小时候也养过一阵子蚕，当然也是小孩子的时候，并不是拿来卖钱的。&lt;/p&gt;

&lt;p&gt;妈妈就带我去采桑叶给它们吃。最近的桑树是在我一二年级就读的小学里，走路过去十分钟的距离。我们趁着周末进去采了不少，季节对的时候，还会顺带采些桑果。现在有时候从超市买桑果吃，我也会想起以前的这段时光——宝宝吃叶子，xx吃果子（xx是我闺名，不能告诉你们）。&lt;/p&gt;

&lt;p&gt;看着以前的学校，我还挺有感触的，想到自己一直年级第一的风光，和现在只能在班级排到前五，也没什么朋友，对我当时幼小的心灵的打击，不能说是不大。即使在今天，我也不能说，我能够淡然处之。&lt;/p&gt;

&lt;p&gt;后来，蚕宝宝在我的悉心照料下，越长越白，越长越胖。身子慢慢变得有些半透明，甚至还隐约可以看到体内吃下去叶子的绿色。&lt;/p&gt;

&lt;p&gt;再后来，它们不怎么吃叶子了，整天仰着脖子，好像在锻炼吐丝的动作。
在开始吐丝的那天前，它们会留下这辈子唯一一泡尿，直径约两三厘米的黄色斑点，是它们作为蚕宝宝的最后印记。&lt;/p&gt;

&lt;p&gt;每天放学回家第一件事，就是看看它们作茧自缚的进度。随着它们摇头晃脑把丝围得越来越周密，我也越来越看不清了。&lt;/p&gt;

&lt;p&gt;妈妈教我把茧移到一张白纸上，放入不封口的纸盒子中。然后就是很多天没有动静，直到有一天它们咬破这层自己织成的丝网，破茧而出。我不想把这一刻描绘得多么伟大或不可思议，因为现实是，即是同样是作茧化蝶，眼前的这些蛾子真的好丑。&lt;/p&gt;

&lt;p&gt;而这又是一个对丑者很残忍的世界。&lt;/p&gt;

&lt;p&gt;我的心里泛起一阵恶心。&lt;/p&gt;

&lt;p&gt;只有这时候，才能看出雌雄的差别，雌蛾子在交配前的肚子就相对较大，而整个体型更小。在交尾之后，白纸上留下了一百多个比芝麻还小的滚圆的卵。再之后，蛾子也完成了自身使命似的一动不动地躺在盒子里。&lt;/p&gt;

&lt;p&gt;我不知道当时望着它们一次次发呆的我，是否思考过，我们自身的命运，又在多大程度上与之截然不同？&lt;/p&gt;

&lt;p&gt;第二年，为了照顾这一百多条蚕宝宝，我的采桑行动更加大规模了。我甚至萌生过在家门前种桑树的想法，然而被妈妈严厉禁止了，理由是，在上海话中，“桑树”和“丧事”是一样的发音。&lt;/p&gt;

&lt;p&gt;第三年，我们搬家了，我也要上初中了，没地方采桑叶了。&lt;/p&gt;

&lt;p&gt;我让爸妈把孵化出的一千多条蚕宝宝送给同事，千叮万嘱要他们好好照顾蚕宝宝——那些和我当年拿到手时，一样又短又黑的蚕宝宝。那些有孩子的同事，大多非常高兴地收下了这些宠物——至少，妈妈是这样告诉我的。&lt;/p&gt;

&lt;p&gt;后面的故事我就不知道了，但我想，它们中间还能有基因保存至今的可能，大概也微乎其微。
​&lt;/p&gt;
</description>
                <pubDate>Wed, 17 Aug 2016 00:00:00 +0000</pubDate>
                <link>http://www.freeclan.net/tyrantax/2016/08/17/sericulture/</link>
                <guid isPermaLink="true">http://www.freeclan.net/tyrantax/2016/08/17/sericulture/</guid>
            </item>
        
            <item>
                <title>Non UI-Blocking JavaScript</title>
                <description>&lt;p&gt;JavaScript often behaves like a multi-thread language with it’s event-based nature.&lt;/p&gt;

&lt;p&gt;But it’s not.&lt;/p&gt;

&lt;p&gt;John Resig, author of &lt;em&gt;Secrets of JavaScript Ninja&lt;/em&gt;, explained &lt;a href=&quot;http://ejohn.org/blog/how-javascript-timers-work/&quot;&gt;how timers work in JavaScript&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Of course, you may use &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers&quot;&gt;Web Works&lt;/a&gt; to do the labor. But it’s &lt;a href=&quot;http://caniuse.com/#search=worker&quot;&gt;support situation&lt;/a&gt; is quite a drawback.&lt;/p&gt;

&lt;p&gt;In this post, I’m talking about how to prevent blocking UI when doing some heavy work in JavaScript.&lt;/p&gt;

&lt;h1 id=&quot;a-nave-version&quot;&gt;A Naïve Version&lt;/h1&gt;

&lt;p&gt;We have some job that cannot be paused, called &lt;code class=&quot;highlighter-rouge&quot;&gt;doHeavyJob&lt;/code&gt; in this case. During the job, however, we want to know how many loops have be run. So we update the content of a log &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;div&amp;gt;&lt;/code&gt; in each loop, after a turn of &lt;code class=&quot;highlighter-rouge&quot;&gt;doHeavyJob&lt;/code&gt; is done.&lt;/p&gt;

&lt;p&gt;This is what may probably come to our mind by intuition.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-html&quot; data-lang=&quot;html&quot;&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;log&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/div&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;logPanel&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getElementById&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'log'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;txt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;logPanel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;innerHTML&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;txt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;', '&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;txt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;doHeavyJob&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// update UI in each loop&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;doHeavyJob&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10000000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;Math&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;If you open console, you should find log information is printed with each loop of &lt;code class=&quot;highlighter-rouge&quot;&gt;i&lt;/code&gt;, but DOM is not updated until all 100 loops are finished.&lt;/p&gt;

&lt;p&gt;Since JavaScript is single-thread, UI shares the same thread with logic. So how should we tell the logic to stop some time for UI to update?&lt;/p&gt;

&lt;h1 id=&quot;an-attempt-with-settimeout&quot;&gt;An Attempt with &lt;code class=&quot;highlighter-rouge&quot;&gt;setTimeout&lt;/code&gt;&lt;/h1&gt;

&lt;p&gt;With &lt;code class=&quot;highlighter-rouge&quot;&gt;setTimeout(func, 0)&lt;/code&gt;, we can tell JavaScript to execute a function immediately once it’s free from previous work.&lt;/p&gt;

&lt;p&gt;Guess how this may work?&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;doHeavyJob&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;setTimeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;})(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Hopefully, you won’t get too surprised to see the &lt;code class=&quot;highlighter-rouge&quot;&gt;(function (i) { ... })(i)&lt;/code&gt; part. It’s a &lt;a href=&quot;http://benalman.com/news/2010/11/immediately-invoked-function-expression/&quot;&gt;Immediately-Invoked Function Expression (IIFE)&lt;/a&gt; to make sure &lt;code class=&quot;highlighter-rouge&quot;&gt;i&lt;/code&gt; remains expected after the &lt;code class=&quot;highlighter-rouge&quot;&gt;for&lt;/code&gt; loop ends.&lt;/p&gt;

&lt;p&gt;Anyway, this attempt expects &lt;code class=&quot;highlighter-rouge&quot;&gt;setTimeout&lt;/code&gt; to &lt;em&gt;create a new thread&lt;/em&gt; to update DOM, and keeps &lt;code class=&quot;highlighter-rouge&quot;&gt;doHeavyJob&lt;/code&gt; running alongside.&lt;/p&gt;

&lt;p&gt;But as we talked above, &lt;strong&gt;there won’t be a new thread after all&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;What happens here is that, &lt;code class=&quot;highlighter-rouge&quot;&gt;setTimeout&lt;/code&gt; is called in each loop, and &lt;code class=&quot;highlighter-rouge&quot;&gt;function() { log(i); }&lt;/code&gt; is pushed into a queue to be executed once it’s free.&lt;/p&gt;

&lt;p&gt;And when will it be free?&lt;/p&gt;

&lt;p&gt;The answer is, after 100 loops of &lt;code class=&quot;highlighter-rouge&quot;&gt;doHeavyJob&lt;/code&gt;. So, DOM is updated only after that.&lt;/p&gt;

&lt;h1 id=&quot;another-attempt-with-settimeout&quot;&gt;Another Attempt with &lt;code class=&quot;highlighter-rouge&quot;&gt;setTimeout&lt;/code&gt;&lt;/h1&gt;

&lt;p&gt;This time, we put &lt;code class=&quot;highlighter-rouge&quot;&gt;doHeavyJob&lt;/code&gt; into another &lt;code class=&quot;highlighter-rouge&quot;&gt;setTimeout&lt;/code&gt;.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;setTimeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;doHeavyJob&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;setTimeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;})(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;It works in a way that a group of &lt;code class=&quot;highlighter-rouge&quot;&gt;i&lt;/code&gt;’s are printed at the same time after interval. This is because the &lt;code class=&quot;highlighter-rouge&quot;&gt;setTimeout&lt;/code&gt; of &lt;code class=&quot;highlighter-rouge&quot;&gt;doHeavyJob&lt;/code&gt; gives chances for others to execute, which includes DOM updating.&lt;/p&gt;

&lt;h1 id=&quot;more-aggressively&quot;&gt;More Aggressively?&lt;/h1&gt;

&lt;p&gt;For some cases, we want to know more than a rough impression of progress bar. In this case, you may add a &lt;code class=&quot;highlighter-rouge&quot;&gt;pause&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;resume&lt;/code&gt; function for &lt;code class=&quot;highlighter-rouge&quot;&gt;heavyJob&lt;/code&gt; so as to break the elephant into pieces. And there should be a consideration over the balance between the accuracy of progress and the overall efficiency.&lt;/p&gt;
</description>
                <pubDate>Wed, 27 Jul 2016 00:00:00 +0000</pubDate>
                <link>http://www.freeclan.net/tyrantax/2016/07/27/non-ui-blocking-javascript/</link>
                <guid isPermaLink="true">http://www.freeclan.net/tyrantax/2016/07/27/non-ui-blocking-javascript/</guid>
            </item>
        
            <item>
                <title>上海当代艺术博物馆游记 伪文青的艺术之旅</title>
                <description>&lt;p&gt;先说结论，我觉得总体来说还是值得去的，有一些很“冷”的梗，如果能 get，会觉得设计师的想法比较有意思。的确也有一半以上是我不能理解作者意图，或是觉得很无聊的。但是，还是有会让人眼前一亮的作品。&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;toggle-img&quot; src=&quot;http://www.freeclan.net/tyrantax/img/loading.gif&quot; data-src=&quot;http://www.freeclan.net/tyrantax/img/post/2016-07-16-visiting-museum-of-contemporary-art-shanghai-01.jpg&quot; /&gt;八号线西藏南路站出口的这个《纸间现实》展览就是在去之前，对我最大的吸引吧！&lt;/p&gt;

&lt;p&gt;很久没来这里附近了，2010 年的时候，在这里做世博志愿者，所以对一些地方还是有比较深的印象的，比如现在博物馆旁边的“大烟囱”——世界最大温度计。&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;single-img&quot; src=&quot;http://www.freeclan.net/tyrantax/img/loading.gif&quot; data-src=&quot;http://www.freeclan.net/tyrantax/img/post/2016-07-16-visiting-museum-of-contemporary-art-shanghai-02.jpg&quot; /&gt;&lt;/p&gt;

&lt;p&gt;周围路上人非常少，以至于我都想怀疑这是不是上海了……&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;single-img&quot; src=&quot;http://www.freeclan.net/tyrantax/img/loading.gif&quot; data-src=&quot;http://www.freeclan.net/tyrantax/img/post/2016-07-16-visiting-museum-of-contemporary-art-shanghai-03.jpg&quot; /&gt;&lt;/p&gt;

&lt;p&gt;这就是我期待的《纸间现实》啦！事实上，这张照片拍得挺有意思的，因为它反应了来这个艺术博物馆的典型人群——文艺女青年、摄影爱好者、带着孩子来的家长、没事做的中年大妈，以及谈恋爱找不到新鲜去处的情侣。&lt;/p&gt;

&lt;p&gt;那么问题来了，我属于哪类呢？:joy:&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;post-img&quot; src=&quot;http://www.freeclan.net/tyrantax/img/loading.gif&quot; data-src=&quot;http://www.freeclan.net/tyrantax/img/post/2016-07-16-visiting-museum-of-contemporary-art-shanghai-05.jpg&quot; /&gt;&lt;img class=&quot;post-img&quot; src=&quot;http://www.freeclan.net/tyrantax/img/loading.gif&quot; data-src=&quot;http://www.freeclan.net/tyrantax/img/post/2016-07-16-visiting-museum-of-contemporary-art-shanghai-06.jpg&quot; /&gt;《平常至极》是我觉得其中难得毕竟有意思的一本装帧设计，想象一下，你买来的书真的用一个回形针夹着一张便签作为封面，而书名恰好是《平常至极》。是啊，这再正常不过了吧？&lt;/p&gt;

&lt;p&gt;还有带着一只耳朵的书，略显惊悚，大概是想表达聆听吧！&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;single-img&quot; src=&quot;http://www.freeclan.net/tyrantax/img/loading.gif&quot; data-src=&quot;http://www.freeclan.net/tyrantax/img/post/2016-07-16-visiting-museum-of-contemporary-art-shanghai-07.jpg&quot; /&gt;&lt;/p&gt;

&lt;p&gt;上图是我觉得非常有意思的一个摄影作品。这是一张毕业照片，但是其实这里面都是同一个人！摄影师想通过这张照片表达每个女生都想表现自己的特点。这个脑洞我非常喜欢！&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;post-img&quot; src=&quot;http://www.freeclan.net/tyrantax/img/loading.gif&quot; data-src=&quot;http://www.freeclan.net/tyrantax/img/post/2016-07-16-visiting-museum-of-contemporary-art-shanghai-08.jpg&quot; /&gt;我有个假想空间，里面有个像这图一样的螺旋阶梯，阶梯外围都是书。拾级而上亦可，席地读书亦可。不过我的透视水平有限，一直没能把这个空间画出来。所以看到这个模型，特意拍下来，争取以后参考着画出我想表达的效果。&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;toggle-img&quot; src=&quot;http://www.freeclan.net/tyrantax/img/loading.gif&quot; data-src=&quot;http://www.freeclan.net/tyrantax/img/post/2016-07-16-visiting-museum-of-contemporary-art-shanghai-09.jpg&quot; /&gt;有些作品真的比较“冷”，而我也很“冷”地把拍照的人一起收入我的作品。&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;single-img&quot; src=&quot;http://www.freeclan.net/tyrantax/img/loading.gif&quot; data-src=&quot;http://www.freeclan.net/tyrantax/img/post/2016-07-16-visiting-museum-of-contemporary-art-shanghai-10.jpg&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;post-img&quot; src=&quot;http://www.freeclan.net/tyrantax/img/loading.gif&quot; data-src=&quot;http://www.freeclan.net/tyrantax/img/post/2016-07-16-visiting-museum-of-contemporary-art-shanghai-11.jpg&quot; /&gt;此馆有非常多“辣眼睛”的作品，比如这个粉色的城堡……&lt;/p&gt;

&lt;p&gt;总结一下~ 上海当代艺术博物馆，听上去就特别高大上。作为一个伪文青，去这样的地方我是挺虚的，因为对艺术的鉴赏能力实在有限，也很少去艺术馆博物馆之类的。之所以今天想到去，主要是想一个人找个地方逛逛，正好今天有同学给我推荐了这个地方。&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;toggle-img&quot; src=&quot;http://www.freeclan.net/tyrantax/img/loading.gif&quot; data-src=&quot;http://www.freeclan.net/tyrantax/img/post/2016-07-16-visiting-museum-of-contemporary-art-shanghai-04.jpg&quot; /&gt;今天逛了两小时上海当代艺术博物馆，本来的行程是逛完去福州路书城的，但是由于为了给自己一个好心情，我特地穿着高跟鞋出门，所以后来就走不动了，放弃了去书城的计划。:joy:说起来，我今天还特地化了妆出门（有图有真相，看不出？因为我不化也这么美啊哈哈~~:wink:），虽然我也说不清到底有没有因为化妆而心情更好……但是被高跟鞋坑了是肯定的！在写博客的过程中，我一直在单曲循环这首徐良的《高跟鞋》，推荐给大家~&lt;/p&gt;

&lt;iframe frameborder=&quot;no&quot; border=&quot;0&quot; marginwidth=&quot;0&quot; marginheight=&quot;0&quot; width=&quot;300px&quot; height=&quot;86&quot; src=&quot;http://music.163.com/outchain/player?type=2&amp;amp;id=421148491&amp;amp;auto=0&amp;amp;height=66&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;感觉今天心情的确好多了，我做了很多事情改善心情，所以也很难说是不是因为逛了有趣的展览~ 也祝读者有个好心情哟！&lt;/p&gt;
</description>
                <pubDate>Sat, 16 Jul 2016 00:00:00 +0000</pubDate>
                <link>http://www.freeclan.net/tyrantax/2016/07/16/visiting-museum-of-contemporary-art-shanghai/</link>
                <guid isPermaLink="true">http://www.freeclan.net/tyrantax/2016/07/16/visiting-museum-of-contemporary-art-shanghai/</guid>
            </item>
        
            <item>
                <title>过敏这件可大可小的事</title>
                <description>&lt;p&gt;我有种很阿 Q 的精神，习惯将明明是不利的因素解释为有利的潜因——自然地，这种技能也被我理解为一种优势。&lt;/p&gt;

&lt;p&gt;今天起床，发现手臂上的过敏退了一半。&lt;/p&gt;

&lt;p&gt;好像一年四季过敏的日子总有三季，既不知道为什么过敏，也不知道为什么消退。看过医生，验过血，吃过药，总也没大好过。后来也就不大信这是可以被治疗的，索性接受了过敏作为我的一部分。也就是在吃海鲜的时候会比较迟疑，遇着实在想吃的时候就跟自己说，反正也查不出过敏原，海鲜会让我过敏的几率也未必大于不过敏的，索性就吃吧——幸而我并不是吃货。&lt;/p&gt;

&lt;p&gt;慢慢地，我把过敏作为心思细腻敏感的副产品去理解。身体和精神紧紧相关，既然享受了敏感带给我的更多体验，自然也不能摆脱过敏的代价。&lt;/p&gt;

&lt;p&gt;如果你觉得这种想法有点似曾相识，那么或许是因为你听说过斯德哥尔摩综合症候群。&lt;/p&gt;

&lt;p&gt;想象一下，一群绑匪抢银行，把前一秒还在高兴地领工资的你作为人质绑了，和警察谈判要求二十万人民币以及跑路的车子。警察迟迟不给正面答复，绑匪说，你看，你连二十万都不值，说着，给了你一记响亮的耳光。另一个绑匪说，罢了，把人质弄死了我们也活不成。说着，到旁边的饮水机那里取了个一次性杯子，递给你半杯水。你迟疑地接过水，喝了一口，微微有点甜，居然还有点感动，想着被解救出去以后要为他求情。然而还没等你来得及说声谢谢，这绑匪就被爆头了。被救出之后，你埋怨警方为什么不赶紧给钱，视百姓的生死于无物。你斥责狙击手的行为莽撞，万一没一枪毙命，甚至伤及无辜，后果不堪设想。并且，你解释说，那些绑匪也是吃不上饭才做坏事，有些人甚至还不错…&lt;/p&gt;

&lt;p&gt;在长时间和绑匪共处之后，开始同情甚至感激绑匪，不自觉地与其站在同一阵线，这就是斯德哥尔摩综合症候群的典型表现。&lt;/p&gt;

&lt;p&gt;在这个故事里，我就是那个领工资的，过敏就是绑匪，至于警察——我也不知道是什么解救了我。&lt;/p&gt;

&lt;p&gt;过敏久治不愈，就会觉得这是敏感的代价。&lt;/p&gt;

&lt;p&gt;同样，敏感得让自己经常容易被别人不经意间的话伤害，也会倾向于认为敏感是赋予我观察到更多人性、丰富人生体验的一员功臣。所以，&lt;strong&gt;我讨厌别人因为我的敏感而可怜我，或是劝我“改邪归正”，因为他们根本不能理解，即使让一个人一直捂住耳朵是让人拒绝听到噪音的可行方案，一个有耳朵的正常人也断不会整天捂着耳朵生存。&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;让自己观察到更丰富的人性、更容易站在别人的角度上看待问题、成为一个更温暖贴心的人，我不知道我所赋予敏感的这些功劳，是否也是斯德哥尔摩综合症候群的表现，是应对习得性无助的麻木反馈。我不知道我的敏感是否应该被别人欣赏，还是这是病，得治，而且药不能停。&lt;/p&gt;

&lt;p&gt;诚然，面对难以摆脱的厄运，积极的看待方式是减轻痛苦的麻醉剂。但是，&lt;strong&gt;如果这本是一件通过积极的人为干预能够被解决的事，那么麻醉剂的功劳与其剥夺警觉的危害，是否能够功过相抵，就是一件值得探讨的事。&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;答案或许简单得像废话——这件事的利弊还是取决于自己把握的“度”。&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;首先，最基本的自我要求是，得让自己不容易因过度的敏感而强烈影响到情绪，有更强的心理韧性（resilience）应对负面的评价。&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;“情商”的定义是对情绪的感知和控制能力，同样地，在自己敏感的时候，感知到自己是因为敏感而受伤，和控制住自己敏感的情绪是至关重要的。自己可能是最了解自己的人，用自己最能接受的方式说服自己是明智之举。如果是比较理性的人，就尝试用理性的归因说服自己，感觉受伤的原因可能只是自己敏感了。&lt;/p&gt;

&lt;p&gt;不仅仅应该做到表现得自己没有被消极的评价影响到，而且还应该真的让自己想通，并且做到不被影响到。保持微笑不失态、卖个萌表示自己没有生气是容易的，但是，真的让自己不要介意，这就不是那么简单的事了。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;其次，不能因为自己敏感就要求别人更小心谨慎对待自己，或是以鼓励的态度给自己更多正面评价。&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;正如对于女权主义来说，争取超过平等的女性福利，可能反而不利于获取男女平等一样，任何要求比其他人更多“特权”的群体，都是在置自身于需要特别关爱的“弱势群体”位置，因而必然会在某种程度上失去他人的尊重，也就从一开始放弃了被平等对待的可能。&lt;/p&gt;

&lt;p&gt;错的不是那些直肠子的人，尤其不是那些对事不对人的意见相左者，甚至可能也不是我们的敏感，而是如何对待这种情况的心态。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;第三，充分认识敏感的利弊，不要因此过分否定自己，也不要过分自豪。&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;要警惕类似斯德哥尔摩综合症侯群的心态，一个人最得意自矜的方面，也常常是这个人自卑亟需认可之所在。并不是要求杜绝所有自卑和自得的心态，因为它们其实常常也加速了我们的个人成长。只是，当自己表现出这些心态的时候，最好是有意识的，因为只有这样，才能将其控制在一个积极的强度内——&lt;/p&gt;

&lt;p&gt;不至于因为过度的自卑而放弃努力，也不至于因为过度的自得而停止奋斗。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;最后，也是最重要的一点，深刻挖掘让自己敏感的真正原因，才能找到控制敏感副作用的有效方法。&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;第一条中所说的缓解敏感带来的负面影响，是暂时性的解决方案，目的是让自己赶紧从负面情绪中摆脱出来。而在这条中所说的目的，是为了从长远的角度，把敏感变成一件尽可能可控的事。&lt;/p&gt;

&lt;p&gt;要知道，一个人不可能没有理由地敏感，只是大多数情况下很难说清原因。或是因为从人类多样性的角度，在基因中先天遗传或是变异出了敏感的特质，使得那些大大咧咧的人不至于因为所有人在夜晚放心酣睡而导致种族灭绝；或是因为长期在竞争激烈的生存环境中，学会通过察言观色更好地博弈个人权利；又或是因为受到社会价值取向或崇拜对象的影响，潜意识中模仿趋同等等……大多数时候，都会有很多复杂的因素综合影响造成，很难抽丝剥茧地缕清因果。但是，对于某一件具体的让人感觉到敏感的事，要分析原因还是可能的。&lt;/p&gt;

&lt;p&gt;有的时候，我们会用那些让我们感觉更舒服的归因方式去分析，即使这听起来比较牵强。比如认为自己的想法总是得不到某人的认可，是因为对方是一个固执的人，即使明白他是针对事情而不是针对我，但是还是会让我很受伤。这种解释可能也不总是完全错误的，但这不是让我们敏感的真正原因，因为就事论事的意见相左者常常可以遇到，但让我们感觉不舒服的情况却显然没有这么多，这是为什么？&lt;/p&gt;

&lt;p&gt;因为我们真的感觉到受伤的，并不是他跟我想法不一样或是他不接受我的观点，而可能是潜意识中被我们忽视的原因——比如，其实是因为自己对业务不熟悉，导致没法在同样认识的基础上平等沟通。“人的一切痛苦，本质上都是对自己无能的愤怒”大概就是这个意思，使自己变得敏感的，往往不是达不到别人的期望，而恰恰是自己的。当然，你可以选择降低自己的期望，或者再努力一把，达到自己的期望。&lt;/p&gt;

&lt;p&gt;如果认识到这一点，就会明白，在这个敏感问题中，解决的关键在于自己去熟悉业务，而不是告诉对方自己是个敏感的人，希望以后多尊重自己的想法——后者虽然看似是积极的沟通，其实却并不高明，它只会让你显得很不专业，正如第二条所说，长远来看，只是将被尊重的可能性大幅降低了。想明白这点，就能触类旁通地解决很多类似的困扰，虽然让一个人敏感的原因可能有很多种，但每次举一反三，还是很有希望将敏感控制在一定程度内的。&lt;/p&gt;

&lt;p&gt;很难得不以搞笑的文风探讨严肃的话题，甚至还写了这么长。有时候我也会怀疑，把自己塑造成“段子手”，是不是从某种角度上也是潜意识以诙谐掩盖自卑的一面。&lt;/p&gt;

&lt;p&gt;对于敏感而言，我远不敢说自己已经处理得很好，那样的话，根本就没有理由写这么多文字。看了很多心理学的书，拥有还算厉害的自我说服能力，但敏感的毛病还会不时拜访。希望有一天，我的敏感也像手臂上的过敏一样好起来，即使我自己可能并不知道是为什么。并不奢望明年春天过敏就不复发了，至少下次，我会不那么受其困扰。&lt;/p&gt;

&lt;p&gt;上次谈论敏感的话题，有很多人反馈了类似的经历，不知道这篇文章对他们有没有帮助。至少，写完这篇文章，我自己释然很多。&lt;/p&gt;

&lt;p&gt;或许，就像上文说的：“如果是比较理性的人，就尝试用理性的归因说服自己”。&lt;/p&gt;

&lt;p&gt;嗯，疗效不错。&lt;/p&gt;
</description>
                <pubDate>Sun, 03 Jul 2016 00:00:00 +0000</pubDate>
                <link>http://www.freeclan.net/tyrantax/2016/07/03/being-sensitive/</link>
                <guid isPermaLink="true">http://www.freeclan.net/tyrantax/2016/07/03/being-sensitive/</guid>
            </item>
        
            <item>
                <title>SegmentFault DDay 厦门站分享 前端可视化的测试实践</title>
                <description>&lt;p&gt;大家好，我是羡辙，在百度 EFE 团队开发基于 JavaScript 的开源可视化工具 ECharts。&lt;/p&gt;

&lt;p&gt;通常这样的技术分享，每个嘉宾都会介绍一下工作背景，但是我其实上个月初才以校招生的身份加入百度。来这里之前，百度一下，我就知道其他几位嘉宾都是业界很厉害的前辈。第一次以嘉宾的身份参加技术分享，感谢 stackoverflow——哦不，感谢 segmentfault 给予我的这次机会。啊呀，烧碱，我回去的机票钱还给报销么？&lt;/p&gt;

&lt;p&gt;&lt;em&gt;（烧碱当时表现非常夸张，一脸“你居然犯这种错误，哈哈哈哈”。其实是我设计好的段子，原来把他都骗过了哈哈！他说怪我怎么表现得这么自然~ 嘛，人生如戏，全靠演技！）&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;我在 2013 年 10 月的时候，在图灵社区发表了电子书《Three.js 入门指南》。 在去年百度前端学院 IFE 的课程中，我实现了一个基于 JavaScript 的 low-poly 算法，后来经过不断的尝试和改进，发表了相关论文，也成为我毕业课题的一部分。本科在英特尔实习阶段，开发了一个为网页游戏打造的轻便的音乐库，包装了 Web Audio。&lt;/p&gt;

&lt;p&gt;此外，我还基于兴趣做过不少有意思的小项目，因为跟各位前端大神相比，实在班门弄斧，所以在这里就不一一介绍了，有兴趣的话可以到我的 github 看一下。&lt;/p&gt;

&lt;p&gt;首先，我想做个小调查，在座各位没有听说过 ECharts 的请举一下手。&lt;/p&gt;

&lt;p&gt;&lt;em&gt;（现场三百多人，两三个人举手）&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;啊呀，在你们这群从小不爱举手的人面前，我好想再调研一下没有听说过羡辙的。不过，机智如我，这种打脸的事是不会做的。&lt;/p&gt;

&lt;p&gt;我今天也不打算多安利 ECharts，毕竟名声在外。如果是不了解的朋友，对于今天的分享主题，你需要知道的也就是 ECharts 是最好用的前端可视化工具——咱谦虚点，加个“之一”吧！&lt;/p&gt;

&lt;p&gt;作为一个第三方库，测试的重要性不言而喻。&lt;/p&gt;

&lt;p&gt;而在测试渲染相关的产品时，我们首要的目标就是保证渲染结果的正确性。在此基础上，如果能够尽可能自动化地进行测试，就可以更有效率、甚至更可靠地发现问题。&lt;/p&gt;

&lt;p&gt;ECharts 是基于 Canvas 实现的。对 Canvas 的测试，直觉上我们可以通过比较像素的一致来判断，但如何描述测试用例的预期表现、如何保证版本间渲染效果的一致性、如何快速定位到 bug 等等问题，对于前端可视化实践而言，仍然是一个很新的话题。&lt;/p&gt;

&lt;p&gt;因此，今天我想和大家分享一些在我们为 ECharts 做测试时候获得的经验，希望能和大家针对“如何测试前端可视化产品”这一主题展开讨论。&lt;/p&gt;

&lt;p&gt;在此之前，让我们先来了解一下，比较通用的前端测试在测些什么。&lt;/p&gt;

&lt;p&gt;可能对前端了解并不多的人，会认为前端等同于用户界面 UI。但随着项目业务逻辑越来越复杂，前端的测试和 native 的、PC 的测试类型并没什么差别。&lt;/p&gt;

&lt;p&gt;从测试的指标来分，可以分为功能测试和非功能测试，后者主要是指性能。&lt;/p&gt;

&lt;p&gt;用户界面通常是比较难测的一种，而之所以困难，很多时候就是因为预期的难以描述。&lt;/p&gt;

&lt;p&gt;提到前端的测试框架，可能最有名的就是这三个了。&lt;/p&gt;

&lt;p&gt;最老牌的 QUnit 发布于八年前，仰仗 jQuery 的大腿名噪一时。&lt;/p&gt;

&lt;p&gt;Jasmine 的发布使大家突然开始关注行为驱动开发（BDD）。&lt;/p&gt;

&lt;p&gt;我想，大家应该都知道 TDD，Test Driven Development，测试驱动开发。TDD 一个很重要的思想是“测试先行”，也就是先针对接口先写测试用例，mock 数据使得测试用例都通过，然后再实现接口。在这一过程中，如果引入了非预期的测试结果，第一时间就能发现，而不是在瀑布开发模型中，等整个项目都完成了再测试，这时候的软件可能已经是千疮百孔，很难定位到 bug。&lt;/p&gt;

&lt;p&gt;而行为驱动开发 BDD 其实和 TDD 并不矛盾，或者说，它也是提倡测试先行的。其实这两者的差异非常微妙，更多表现在测试语法的差异上，这一点我们稍后再了解。&lt;/p&gt;

&lt;p&gt;Mocha 是在 Jasmine 推出后两年，也就是 2012 年发布的。因为同样是 BDD 的风格，所以和 Jasmine 的相似度非常高，只是支持更多的插件，因此可配置性更高。你可以使用自己喜欢的断言库配合 Mocha，比如这个叫 Chai 的断言库就比较有名。这个看似中文拼音的名字，其实是取 chain 链条这个英文单词的开头部分，因为该断言库支持链式语法，这也是 BDD 的一大风格。&lt;/p&gt;

&lt;p&gt;我们可以看到，Jasmine 的语法和 Mocha 是非常类似的，而 jUnit 显示是另一种风格。从这里我们其实就能比较清楚地看到 TDD 和 BDD 的差异。&lt;/p&gt;

&lt;p&gt;从语法的角度，我们发现 TDD 的语法还是不够直观，可能不熟悉的人还要去查这个 test 和 equal 函数对应的参数是什么。相比之下，BDD 的语法非常接近自然语言。比如我们描述一个测试用例，它应该怎么怎么样，我们期望什么是什么等等。比较 Jasmine 和 Mocha 的语法，我们会觉得有非常多的共同点，比较明显的差异就是 Mocha 在开头 require 了 Chai 这个断言库。一般认为 Mocha 对于插件的选择更为灵活，而 Jasmine 因为不需要引入其他插件，所以对于没有特殊要求的情况下，稍微方便一些。&lt;/p&gt;

&lt;p&gt;通常我们说的用户界面相关的测试，通常是指这些——&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;按钮在屏幕的显示位置是否正确？&lt;/li&gt;
  &lt;li&gt;按钮在某个时刻是否是禁止状态？&lt;/li&gt;
  &lt;li&gt;在某个点击事件后，浏览器的标题是否符合预期？&lt;/li&gt;
  &lt;li&gt;……&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;那么，如何自动化测试这些场景呢？上面说的这些通用的前端测试框架就不适用了。&lt;/p&gt;

&lt;p&gt;Nightwatch 是模拟浏览器行为的框架的代表。&lt;/p&gt;

&lt;p&gt;从这段代码我们可以看到，这个测试框架可以设定访问的 URL 地址，然后等待一秒，直到 body 出现。然后，断言标题为 Google 并且搜索框可见。接着，将搜索框内容设为某个值，等待一秒直到搜索按钮出现，点击搜索，等一秒，断言搜索到的第一条是 Wikipedia 的记录。&lt;/p&gt;

&lt;p&gt;以上是比较典型的前端测试，但是我们今天重点要讨论的是测试和渲染相关的部分。与用户界面无关的测试，其实已经讨论地比较充分。但是与界面相关的测试，非但前端做得比较少，就是比较传统的客户端 UI 测试，一直也是做得不充分的，要么依赖人眼看，要么索性不做，因为测试界面相关的成本是很高的。而说到前端渲染相关的测试，往往则更加测得少。但是 ECharts 作为一个可视化产品的第三方库，测试渲染相关部分又是非常重要的。&lt;/p&gt;

&lt;p&gt;我们知道 HTML、SVG 的测试可以借鉴前面 Nightwatch 的例子，主要是通过 DOM 树去分析是否符合预期。但 ECharts 主要是基于 Canvas 的，那 Canvas 怎么测？&lt;/p&gt;

&lt;p&gt;直观上，我们觉得有这么两种方法，一个是人眼看，还有一个是使用 toDataURL 保存成图片比较。但是在实际操作的过程中，它们都是有比较大问题的。&lt;/p&gt;

&lt;p&gt;比如靠人眼看，我们知道，ECharts 的配置项非常非常多，因此对应的测试用例也多到难以想象。而且我们平均一两周就发布一个新版本，如果每次新版本发布前的测试，都要依赖人眼看，那这个工作量是非常巨大的。另一方面，人眼观察的结果肯定并不精确，对于细小的渲染差异，可能无法发觉。&lt;/p&gt;

&lt;p&gt;同样，通过比较 Canvas 图像的方法，图像相同就意味着渲染正确了吗？我们应该如何设计用例来描述预期，并且尽可能自动化地进行测试？这些都是我们今天想和大家具体探讨的。&lt;/p&gt;

&lt;p&gt;首先，我们来看一下 ECharts 的渲染无关部分是怎么测试的。&lt;/p&gt;

&lt;p&gt;比如这个线性数据管理模块 &lt;code class=&quot;highlighter-rouge&quot;&gt;List&lt;/code&gt;，我们使用 Jasmine 做单元测试。这个 &lt;code class=&quot;highlighter-rouge&quot;&gt;utHelper.prepare&lt;/code&gt; 是我的自己写的一个辅助函数，主要用于清理测试环境，并且加载需要测试的库。然后就是测试 list 的内容是否符合预期，还是 Jasmine 的套路，没什么新的内容，我们很快的过一下。那么，如何测渲染相关部分呢？&lt;/p&gt;

&lt;p&gt;Echarts 的大部分设置都是通过一个叫 &lt;code class=&quot;highlighter-rouge&quot;&gt;setOption&lt;/code&gt; 的函数传入配置项的。这里我们要测试 &lt;code class=&quot;highlighter-rouge&quot;&gt;titile.text&lt;/code&gt; 配置项能否和文档所说，可以使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;\n&lt;/code&gt; 换行。&lt;/p&gt;

&lt;p&gt;我们来看手动测试应该怎么做。我们设置好参数，然后查看是否渲染的结果在预期的位置换行了。&lt;/p&gt;

&lt;p&gt;结果是这样的，然后我们认为这个用例表现正常，符合预期。&lt;/p&gt;

&lt;p&gt;那么，如果要自动化做这样的测试呢？&lt;/p&gt;

&lt;p&gt;有这么几种思路。&lt;/p&gt;

&lt;p&gt;首先我们可以给定两组不同的配置项，我们期望这两个配置项得到的渲染结果相同或者不同。&lt;/p&gt;

&lt;p&gt;期望相同的例子比如，一个配置项不设置字体，另外一个配置项设置等于文档中所说的默认字体颜色，然后，我们期望这两者得到的渲染结果相同。期望不同的例子比如，一个配置项不设置字体颜色，另外一个设置了一个不等于默认的颜色，然后，我们期望这两者得到的渲染结果不同。&lt;/p&gt;

&lt;p&gt;此外，为了确保渲染的正确性，并且尽可能自动化，我们只对某个特定版本使用人眼判断，作为基线版本，在此之后，每个版本都和这个人眼看过的版本的 Canvas 进行比较。&lt;/p&gt;

&lt;p&gt;当然，如果 Canvas 和基线版本的不一样，就一定能说这是个 bug 吗？很有可能就是这个版本我们实现了一个新功能，导致渲染的结果本该不同。那么，在这种情况下，如何快速定位到这个问题，并且判断出这是个 bug 还是 feature 呢？&lt;/p&gt;

&lt;p&gt;首先，我们可以使用 js-imagediff 生成两个 Canvas 的 diff 图像，然后就能很清楚地看到差异处。其次，我们可以比较对 Canvas 的操作栈，也就是所有 Canvas 操作，如在某处使用某种颜色绘制了特定大小的长方形。&lt;/p&gt;

&lt;p&gt;那么，Canvas 要怎样才算相等呢？&lt;/p&gt;

&lt;p&gt;很容易想到的一个办法是使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;Canvas.toDataURL&lt;/code&gt; 生成 Canvas 的图像进行比较，如果字符串相同，那么认为图像相同。&lt;/p&gt;

&lt;p&gt;此外，Canteen 这个库帮我们记录对 Canvas 的操作，提供比较上述的操作，也能比较 Canvas 的差异。&lt;/p&gt;

&lt;p&gt;我们知道，对于同一个底层绘图环境，Canvas 操作相同，渲染出的图像一定相同，反之则不成立。&lt;/p&gt;

&lt;p&gt;所以我们说，操作一致是图像一致的充分非必要条件。&lt;/p&gt;

&lt;p&gt;&lt;em&gt;（说到这里，大家都笑了，然而这本来并不是个段子……大概是我非常严肃地说了这么句学究气这么重的句子……）&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;实践发现，比较 Canvas 内容的操作更简单，因为它不依赖第三方库。而相比之下，比较 Canvas 操作是一种更严格的测试，因此也更容易帮我们发现潜在错误。&lt;/p&gt;

&lt;p&gt;之前说的 Canvas diff 的效果是这样的。我们乍一看，左边和中间的两个图非常相似，甚至对于接近度更高的图像，可能处女座都不一定看得出区别。在这种情况下，我们看一下 diff 图，只要图中有不是黑色的部分，我们就知道这里出现差别了。所以，这是一种能帮我们快速定位到问题所在的方法。&lt;/p&gt;

&lt;p&gt;接下来，让我们通过具体的例子来说明。&lt;/p&gt;

&lt;p&gt;我们想要测试默认的字重是不是等于 normal。为此，我们写了两个配置项，其中一个的字重没设置，另外一个设为 normal，我们期望这两者得到的渲染效果一致。&lt;/p&gt;

&lt;p&gt;比较 Canvas 的内容和操作我们发现，内容是一致的，但操作是不一致的。&lt;/p&gt;

&lt;p&gt;分析操作栈发现，在 Canvas 上绘制时使用了 bolder 操作，但是由于该字体家族不存在粗体字重，因此实际的显示效果和 normal 相同。因此，这其实是一个 bug。&lt;/p&gt;

&lt;p&gt;所以我们说，在这个测试用例中，比较 Canvas 操作得到的结论是正确的，比较 Canvas 内容得到的结论是漏报的。&lt;/p&gt;

&lt;p&gt;我们再来看另外一个例子。&lt;/p&gt;

&lt;p&gt;这里，我们要测试标题样式设为 &lt;code class=&quot;highlighter-rouge&quot;&gt;oblique&lt;/code&gt; 时，是否被正确地渲染。我们同样写了两个配置项，其中一个设为 &lt;code class=&quot;highlighter-rouge&quot;&gt;oblique&lt;/code&gt;，另外一个设为 &lt;code class=&quot;highlighter-rouge&quot;&gt;italic&lt;/code&gt;。我们期望他们渲染的结果不同。&lt;/p&gt;

&lt;p&gt;首先，我们来分析这个案例存在的一个潜在问题。我们希望测试标题样式为 &lt;code class=&quot;highlighter-rouge&quot;&gt;oblique&lt;/code&gt;，但实际上我们只能通过判断该样式与 &lt;code class=&quot;highlighter-rouge&quot;&gt;normal&lt;/code&gt;、&lt;code class=&quot;highlighter-rouge&quot;&gt;italic&lt;/code&gt; 等的结果不同，从侧面得出结论。这一点在软件测试中是一个普遍存在的潜在问题。我们只能从第一次用人眼看，后面跟这次比较来缓解。&lt;/p&gt;

&lt;p&gt;从实际的渲染结果看，Canvas 内容是一致的，而操作是不一致的。这是为什么呢？&lt;/p&gt;

&lt;p&gt;大家应该都见过 CSS &lt;code class=&quot;highlighter-rouge&quot;&gt;font-style&lt;/code&gt; 属性有 &lt;code class=&quot;highlighter-rouge&quot;&gt;oblique&lt;/code&gt; 和 &lt;code class=&quot;highlighter-rouge&quot;&gt;italic&lt;/code&gt; 属性，都表示斜体，那么有人知道这两者有什么区别吗？&lt;/p&gt;

&lt;p&gt;&lt;em&gt;（没人举手）&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;我也是写了这个测试用例失败了，去搜了才知道的。其实 &lt;code class=&quot;highlighter-rouge&quot;&gt;italic&lt;/code&gt; 是字体设计师手动绘制的斜体字，而 &lt;code class=&quot;highlighter-rouge&quot;&gt;oblique&lt;/code&gt; 是计算机使用斜切处理，把 &lt;code class=&quot;highlighter-rouge&quot;&gt;normal&lt;/code&gt; 的字体处理成斜体的。而一般字体厂商都不会同时提供 &lt;code class=&quot;highlighter-rouge&quot;&gt;oblique&lt;/code&gt; 和 &lt;code class=&quot;highlighter-rouge&quot;&gt;italic&lt;/code&gt; 样式，通常是其中一个不存在的时候，就使用另外一种替代。&lt;/p&gt;

&lt;p&gt;因此，在这个案例中，倒也不能怪比较内容得到的结论是误报的，应该说这是写测试用例的人不知道这点造成的。但这也不能怪我啊，你看你们也都不知道 &lt;code class=&quot;highlighter-rouge&quot;&gt;oblique&lt;/code&gt; 和 &lt;code class=&quot;highlighter-rouge&quot;&gt;italic&lt;/code&gt; 的差别嘛！:D&lt;/p&gt;

&lt;p&gt;所以说，比较操作更容易让我们发现问题。&lt;/p&gt;

&lt;p&gt;我们的结论是，通常比较 Canvas 操作得到的结论更稳健。但比较操作也不总是符合预期的，取决于测试用例，大家可以自己思考一下反例。&lt;/p&gt;

&lt;p&gt;我们推荐的比较方式是，先比较 Canvas 操作；如果测试失败，查看 Canvas 图像 diff 和操作栈 diff。&lt;/p&gt;

&lt;p&gt;总结一下，可视化相关测试的思路是，对渲染无关部分做单元测试，渲染相关部分做 UI 测试。可以测试不同配置项设置下的渲染一致性、测试不同版本的渲染一致性，在遇到错误时，可以查看 Canvas 图像与操作栈 diff 分析失败原因。&lt;/p&gt;

&lt;h2 id=&quot;section&quot;&gt;扩展阅读&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;http://www.techtalkdc.com/which-javascript-test-library-should-you-use-qunit-vs-jasmine-vs-mocha/&quot;&gt;Which JavaScript Test Library Should You Use? QUnit vs Jasmine vs Mocha&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://github.com/kgroat/javascript-test-framework-comparison&quot;&gt;Comparison of three major javascript unit testing frameworks&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;http://marcofranssen.nl/jasmine-vs-mocha/&quot;&gt;Jasmine vs. Mocha&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;http://stackoverflow.com/questions/1680624/font-style-italic-vs-oblique-in-css&quot;&gt;font-style: italic vs oblique in CSS&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;最后，感谢大家对 ECharts 的支持，是大家的使用才使得我们能够越做越好~&lt;/p&gt;
</description>
                <pubDate>Sat, 28 May 2016 00:00:00 +0000</pubDate>
                <link>http://www.freeclan.net/tyrantax/2016/05/28/visualization-test/</link>
                <guid isPermaLink="true">http://www.freeclan.net/tyrantax/2016/05/28/visualization-test/</guid>
            </item>
        
            <item>
                <title>Using ECharts with Angular.js</title>
                <description>&lt;blockquote&gt;
  &lt;p&gt;&lt;a href=&quot;http://echarts.baidu.com&quot;&gt;ECharts&lt;/a&gt; is a powerful JavaScript library to make amazing charts. This post introduces how to use ECharts in &lt;a href=&quot;http://stackoverflow.com/questions/13329485/mvw-what-does-it-stand-for&quot;&gt;&lt;em&gt;MVW&lt;/em&gt;&lt;/a&gt; style.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h1 id=&quot;echarts&quot;&gt;ECharts&lt;/h1&gt;

&lt;div id=&quot;intro-chart&quot; class=&quot;demo&quot;&gt;&lt;/div&gt;

&lt;p&gt;ECharts uses a configurable &lt;code class=&quot;highlighter-rouge&quot;&gt;option&lt;/code&gt; object to control most of its data and visual settings. A typical way to use ECharts after including &lt;code class=&quot;highlighter-rouge&quot;&gt;echarts.js&lt;/code&gt; in HTML is as follows.&lt;/p&gt;

&lt;div class=&quot;language-js highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;dom&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getElementById&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'intro-chart'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;chart&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;echarts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;dom&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;chart&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;setOption&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;backgroundColor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'#08263a'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;title&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'ECharts Example'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;textStyle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'#b1cfa5'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;fontSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;18&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;left&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'center'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;top&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;25&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;xAxis&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;show&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;series&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[{&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'bar'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;...,&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;itemStyle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;normal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;barBorderRadius&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;shadowBlur&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;shadowColor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'#111'&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;To use ECharts with Angular, a very basic requirement is to bind chart option with ECharts instance.&lt;/p&gt;

&lt;h1 id=&quot;html&quot;&gt;HTML&lt;/h1&gt;

&lt;p&gt;Suppose we have an HTML containing multiple elements for ECharts instances.&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;dash-chart&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;eoption=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;vm.eoption.a&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;dash-chart&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;eoption=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;vm.eoption.b&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;dash-chart&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;eoption=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;vm.eoption.c&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Here, &lt;code class=&quot;highlighter-rouge&quot;&gt;eoption&lt;/code&gt; is a user-defined attribute, which could be anything you like.&lt;/p&gt;

&lt;h1 id=&quot;controller&quot;&gt;Controller&lt;/h1&gt;

&lt;p&gt;In Angular controller, we define options as follows. To make the demo simple enough, we only set a title in option.&lt;/p&gt;

&lt;div class=&quot;language-js highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;MyController&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;vm&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;vm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;eoption&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;title&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'This is a'&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;title&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'This is b'&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;title&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'This is c'&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h1 id=&quot;directive&quot;&gt;Directive&lt;/h1&gt;

&lt;p&gt;In Angular directive, we watch each charts and updates option when attribute changes.&lt;/p&gt;

&lt;div class=&quot;language-js highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;dashChart&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;restrict&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'C'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;link&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;scope&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;elem&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;attrs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// directive is called once for each chart&lt;/span&gt;
            &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;myChart&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;echarts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;elem&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;

            &lt;span class=&quot;c1&quot;&gt;// listen to option changes&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;attrs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;eoption&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;nx&quot;&gt;scope&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;$watch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;attrs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'eoption'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;option&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;scope&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;$eval&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;attrs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;eoption&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;angular&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;isObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;option&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;nx&quot;&gt;myChart&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;setOption&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;option&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// deep watch&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Note that we set the third parameter of &lt;code class=&quot;highlighter-rouge&quot;&gt;scope.$watch&lt;/code&gt; to be &lt;code class=&quot;highlighter-rouge&quot;&gt;true&lt;/code&gt;, which makes sure we get notified when any descendant of &lt;code class=&quot;highlighter-rouge&quot;&gt;eoption&lt;/code&gt; changes.&lt;/p&gt;

&lt;p&gt;To watch the change event of DOM attribute, a more straightforward way may be using Angular’s &lt;code class=&quot;highlighter-rouge&quot;&gt;attrs.$observe&lt;/code&gt;. Keller used &lt;code class=&quot;highlighter-rouge&quot;&gt;attrs.$observe&lt;/code&gt; to watch DOM atrribute&lt;sup id=&quot;fnref:keller&quot;&gt;&lt;a href=&quot;#fn:keller&quot; class=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;, but deep watching is not enabled in his example.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;attrs.$observe&lt;/code&gt; doesn’t support the third parameter stating if enables deep watching. &lt;strong&gt;This means it will be triggered only when you set &lt;code class=&quot;highlighter-rouge&quot;&gt;vm.eoption.a&lt;/code&gt; to a new value, but not when &lt;code class=&quot;highlighter-rouge&quot;&gt;vm.eoption.a.title&lt;/code&gt; changes.&lt;/strong&gt;&lt;sup id=&quot;fnref:watch-vs-observe&quot;&gt;&lt;a href=&quot;#fn:watch-vs-observe&quot; class=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

&lt;p&gt;Considering changing part of option is a very common need, and ECharts suggests calling &lt;code class=&quot;highlighter-rouge&quot;&gt;setOption()&lt;/code&gt; with minimal changed option, using &lt;code class=&quot;highlighter-rouge&quot;&gt;scope.$watch&lt;/code&gt; seems to be a better choice over &lt;code class=&quot;highlighter-rouge&quot;&gt;attrs.$observe&lt;/code&gt;.&lt;/p&gt;

&lt;h1 id=&quot;changing-data&quot;&gt;Changing Data&lt;/h1&gt;

&lt;p&gt;To demonstrate data-binding effect, I set the title to be current time, and update it every second.&lt;/p&gt;

&lt;div class=&quot;language-js highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;MyController&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;$interval&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;dateFilter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;vm&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;nx&quot;&gt;vm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;eoption&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;title&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// update data every second&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;$interval&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;vm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;echartsOption&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;userSessionChart&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;title&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;text&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;dateFilter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Date&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'yyyy-d-M HH:mm:ss'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;You should see the Canvas is updating with current time.&lt;/p&gt;

&lt;script type=&quot;text/javascript&quot;&gt;
var loadJs = [['http://www.freeclan.net/tyrantax/js/echarts-all.js', function() {

    var charts = [];
    var introChart = echarts.init(document.getElementById('intro-chart'));
    charts.push(introChart);

    var xAxisData = [];
    var data = [];
    for (var i = 0; i &lt; 50; i++) {
        xAxisData.push(i);
        data.push((Math.sin(i / 5) * (i / 5 -10) + i / 6) * 5)
    }

    introChart.setOption({
        backgroundColor: '#08263a',
        title: {
            text: 'ECharts Example',
            textStyle: {
                color: '#b1cfa5',
                fontSize: 18
            },
            left: 'center',
            top: 25
        },
        xAxis: {
            show: false,
            data: xAxisData
        },
        visualMap: {
            show: false,
            min: 0,
            max: 50,
            dimension: 0,
            inRange: {
                color: ['#4a657a', '#308e92', '#b1cfa5', '#f5d69f', '#f5898b', '#ef5055']
            }
        },
        yAxis: {
            axisLine: {
                show: false
            },
            axisLabel: {
                textStyle: {
                    color: '#4a657a'
                }  
            },
            splitLine: {
                show: true,
                lineStyle: {
                    color: '#08263f'
                }
            },
            axisTick: {
                show: false
            }
        },
        series: [{
            type: 'bar',
            data: data,
            itemStyle: {
                normal: {
                    barBorderRadius: 5,
                    shadowBlur: 10,
                    shadowColor: '#111'
                }
            },
            animationEasing: 'elasticOut',
            animationEasingUpdate: 'elasticOut',
            animationDelay: function (idx) {
                return idx * 20;
            },
            animationDelayUpdate: function (idx) {
                return idx * 20;
            }
        }]
    });



    $(window).resize(function() {
        for (var cid = 0, clen = charts.length; cid &lt; clen; ++cid) {
            charts[cid].resize();
        }
    });
}]];

&lt;/script&gt;

&lt;div class=&quot;footnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:keller&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;http://www.kellerblog.cc/angular-echarts.html&quot;&gt;使用 angular 封装 echarts&lt;/a&gt; &lt;a href=&quot;#fnref:keller&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:watch-vs-observe&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;http://stackoverflow.com/questions/14876112/angularjs-difference-between-the-observe-and-watch-methods&quot;&gt;AngularJS: Difference between the $observe and $watch methods&lt;/a&gt; &lt;a href=&quot;#fnref:watch-vs-observe&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</description>
                <pubDate>Mon, 23 May 2016 00:00:00 +0000</pubDate>
                <link>http://www.freeclan.net/tyrantax/2016/05/23/using-echarts-with-angularjs/</link>
                <guid isPermaLink="true">http://www.freeclan.net/tyrantax/2016/05/23/using-echarts-with-angularjs/</guid>
            </item>
        
    </channel>
</rss>

